{{define "layout"}}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{if .Title}}{{.Title}} · ApiMe{{else}}ApiMe{{end}}</title>
  <link rel="icon" type="image/svg+xml" href="/static/favicon.svg?v=2">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png?v=2">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png?v=2">
  <link rel="apple-touch-icon" sizes="192x192" href="/static/favicon-192x192.png?v=2">
  <link rel="shortcut icon" href="/static/favicon.ico?v=2">
  <style>
    :root {
      color-scheme: light dark;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --bg: #0b1220;
      --surface: rgba(15, 23, 42, 0.9);
      --surface-2: rgba(17, 24, 39, 0.85);
      --border: rgba(255,255,255,0.08);
      --text: #e2e8f0;
      --muted: #94a3b8;
      --primary: #2563eb;
      --primary-2: #7c3aed;
      --focus: rgba(59, 130, 246, 0.35);
      --shadow: 0 20px 60px rgba(0,0,0,0.45);
      --radius: 1rem;
    }
    html {
      background-color: var(--bg);
    }
    [data-theme="light"] {
      color-scheme: light;
      --bg: #f6f7fb;
      --surface: rgba(255, 255, 255, 0.9);
      --surface-2: rgba(255, 255, 255, 0.8);
      --border: rgba(15, 23, 42, 0.12);
      --text: #0f172a;
      --muted: #475569;
      --focus: rgba(37, 99, 235, 0.25);
      --shadow: 0 24px 80px rgba(15,23,42,0.12);
    }
    [data-theme="dark"] {
      color-scheme: dark;
    }
    body {
      margin: 0;
      background: radial-gradient(900px 500px at 50% 0%, rgba(37, 99, 235, 0.25), transparent 60%),
                  radial-gradient(700px 400px at 80% 10%, rgba(124, 58, 237, 0.18), transparent 55%),
                  var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    a { color: inherit; text-decoration: none; }
    header {
      background: var(--surface-2);
      border-bottom: 1px solid var(--border);
      backdrop-filter: blur(10px);
      padding: 1rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      z-index: 100;
    }
    .brand {
      font-weight: 700;
      font-size: 1.1rem;
      letter-spacing: 0.04em;
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }
    .brand svg {
      width: 22px;
      height: 22px;
    }
    nav {
      display: flex;
      gap: 1rem;
      align-items: center;
      font-size: 0.95rem;
    }
    nav a {
      padding: 0.35rem 0.75rem;
      border-radius: 0.5rem;
      color: var(--muted);
    }
    nav a.active {
      color: var(--text);
      background: rgba(59, 130, 246, 0.16);
    }
    nav .user {
      color: var(--text);
      font-weight: 500;
    }
    .nav-actions {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .menu {
      position: relative;
      display: inline-flex;
      align-items: center;
    }
    .menu-dropdown {
      position: absolute;
      top: calc(100% + 10px);
      right: 0;
      min-width: 220px;
      padding: 0.35rem;
      border-radius: 0.9rem;
      border: 1px solid var(--border);
      background: var(--surface);
      box-shadow: var(--shadow);
      display: none;
      z-index: 60;
    }
    .menu-dropdown a {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.55rem 0.7rem;
      border-radius: 0.65rem;
      color: var(--text);
      font-size: 0.95rem;
    }
    .menu-dropdown a:hover {
      background: rgba(148, 163, 184, 0.14);
    }
    .menu-dropdown a.active {
      background: rgba(59, 130, 246, 0.16);
    }
    .menu-divider {
      height: 1px;
      background: var(--border);
      margin: 0.35rem 0.35rem;
    }
    .icon-btn {
      width: 38px;
      height: 38px;
      border-radius: 0.75rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border: 1px solid var(--border);
      background: rgba(148, 163, 184, 0.10);
      color: var(--text);
      cursor: pointer;
      transition: background 0.2s, transform 0.2s;
    }
    .icon-btn--lg {
      width: 44px;
      height: 44px;
      border-radius: 0.9rem;
    }
    .icon-btn:hover {
      background: rgba(148, 163, 184, 0.14);
      transform: translateY(-1px);
    }
    .icon-btn svg {
      width: 22px;
      height: 22px;
    }
    .icon-btn--lg svg {
      width: 26px;
      height: 26px;
    }
    main {
      flex: 1;
      width: min(1100px, 100%);
      margin: 2rem auto;
      padding: 0 1.5rem 3rem;
    }
    h1 {
      margin: 0 0 1.25rem 0;
      font-size: 1.8rem;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
    }
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: 1.25rem;
      box-shadow: var(--shadow);
    }
    .card h3 {
      margin: 0;
      font-size: 0.9rem;
      color: var(--muted);
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }
    .card strong {
      display: block;
      margin-top: 0.65rem;
      font-size: 1.9rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1.5rem;
      font-size: 0.95rem;
    }
    table th, table td {
      padding: 0.85rem 0.5rem;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    table th {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--muted);
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 0.85rem;
    }
    label {
      font-size: 0.85rem;
      color: var(--muted);
    }
    input, select, textarea {
      border-radius: 0.6rem;
      border: 1px solid rgba(148, 163, 184, 0.28);
      background: rgba(15, 23, 42, 0.14);
      padding: 0.65rem 0.85rem;
      color: var(--text);
      font-size: 1rem;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: rgba(37, 99, 235, 0.65);
      box-shadow: 0 0 0 4px var(--focus);
    }
    button {
      border: none;
      border-radius: 0.6rem;
      padding: 0.65rem 1rem;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, var(--primary), var(--primary-2));
      color: #f8fafc;
      transition: opacity 0.2s;
    }
    button.secondary {
      background: rgba(148, 163, 184, 0.15);
    }
    button:hover {
      opacity: 0.9;
    }
    .toast-container {
      position: fixed;
      top: 16px;
      right: 16px;
      z-index: 200;
      width: min(420px, calc(100% - 32px));
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      pointer-events: none;
    }
    .toast {
      pointer-events: auto;
      position: relative;
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.9rem 1rem;
      border-radius: 0.9rem;
      border: 1px solid var(--border);
      background: var(--surface-2);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      overflow: hidden;
      animation: toastIn 180ms ease-out;
    }
    .toast::before {
      content: "";
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: rgba(59, 130, 246, 0.6);
    }
    .toast-icon {
      width: 18px;
      height: 18px;
      margin-top: 2px;
      flex: 0 0 auto;
    }
    .toast-body {
      flex: 1;
      font-weight: 600;
      line-height: 1.3;
    }
    .toast-close {
      border: 0;
      background: transparent;
      color: inherit;
      opacity: 0.8;
      cursor: pointer;
      padding: 0.1rem;
      pointer-events: auto;
      margin-top: -2px;
    }
    .toast-close:hover { opacity: 1; }
    .toast-success {
      border-color: rgba(34, 197, 94, 0.35);
    }
    .toast-success .toast-icon { color: rgba(34, 197, 94, 1); }
    .toast-success::before { background: rgba(34, 197, 94, 0.75); }
    .toast-error {
      border-color: rgba(248, 113, 113, 0.35);
    }
    .toast-error .toast-icon { color: rgba(248, 113, 113, 1); }
    .toast-error::before { background: rgba(248, 113, 113, 0.78); }
    .toast.hiding {
      animation: toastOut 140ms ease-in forwards;
    }
    @keyframes toastIn {
      from { opacity: 0; transform: translateX(12px) translateY(-4px); }
      to { opacity: 1; transform: translateX(0) translateY(0); }
    }
    @keyframes toastOut {
      from { opacity: 1; transform: translateX(0) translateY(0); }
      to { opacity: 0; transform: translateX(12px) translateY(-4px); }
    }
    .status-badge {
      padding: 0.2rem 0.7rem;
      border-radius: 999px;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .status-active { background: rgba(34, 197, 94, 0.2); color: #bbf7d0; }
    .status-pending { background: rgba(250, 204, 21, 0.15); color: #fef9c3; }
    .status-error { background: rgba(248, 113, 113, 0.2); color: #fecaca; }
    .status-disconnected { background: rgba(100, 116, 139, 0.2); color: #cbd5e1; }

    [data-theme="light"] .status-active { color: #15803d; background: rgba(34, 197, 94, 0.2); }
    [data-theme="light"] .status-pending { color: #a16207; background: rgba(250, 204, 21, 0.2); }
    [data-theme="light"] .status-error { color: #b91c1c; background: rgba(248, 113, 113, 0.2); }
    [data-theme="light"] .status-disconnected { color: #334155; background: rgba(100, 116, 139, 0.2); }

    .badge-yes { display:inline-flex; align-items:center; gap:0.25rem; background: rgba(34, 197, 94, 0.2); color: #bbf7d0; padding: 0.2rem 0.6rem; border-radius: 999px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }
    .badge-no { display:inline-flex; align-items:center; gap:0.25rem; background: rgba(248, 113, 113, 0.2); color: #fecaca; padding: 0.2rem 0.6rem; border-radius: 999px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

    [data-theme="light"] .badge-yes { color: #15803d; }
    [data-theme="light"] .badge-no { color: #b91c1c; }
    .actions {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .split {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }
    pre {
      background: rgba(15, 23, 42, 0.12);
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: 1rem;
      max-height: 400px;
      overflow: auto;
    }
  </style>
</head>
<body>
  {{if .UserEmail}}
  <header>
    <a class="brand" href="/dashboard" aria-label="ApiMe" title="ApiMe">
      <img src="/static/logo.png" alt="ApiMe" width="28" height="28" style="display:block;object-fit:contain;" />
      ApiMe
    </a>
    <nav>
      <a href="/dashboard" class="nav-home {{if eq .Path "/dashboard"}}active{{end}}" aria-label="Home" title="Home" style="display:inline-flex;align-items:center;justify-content:center;padding:8px;">
        <svg width="22" height="22" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M3 10.5l9-7l9 7" />
          <path d="M5 9.5v11a2 2 0 0 0 2 2h4v-7h2v7h4a2 2 0 0 0 2-2v-11" />
        </svg>
      </a>
      <div class="nav-actions">
        <button type="button" id="themeToggle" aria-label="Alternar tema" title="Alternar tema" style="background:none;border:none;cursor:pointer;padding:8px;color:currentColor;">
          <svg id="themeIconSun" width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0" />
            <path d="M12 2v2" />
            <path d="M12 20v2" />
            <path d="M4.93 4.93l1.41 1.41" />
            <path d="M17.66 17.66l1.41 1.41" />
            <path d="M2 12h2" />
            <path d="M20 12h2" />
            <path d="M6.34 17.66l-1.41 1.41" />
            <path d="M19.07 4.93l-1.41 1.41" />
          </svg>
          <svg id="themeIconMoon" width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#6b7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
          </svg>
          <svg id="themeIconSunMoon" width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="display:none;">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M9.173 14.83a4 4 0 1 1 5.657 -5.657" />
            <path d="M11.294 12.707l.174 .247a7.5 7.5 0 0 0 8.845 2.492a9 9 0 0 1 -14.671 2.914" />
          </svg>
        </button>
        <div class="menu">
          <button type="button" id="navMenuToggle" aria-label="Menu" title="Menu" aria-haspopup="true" aria-expanded="false" style="background:none;border:none;cursor:pointer;padding:8px;color:currentColor;">
            <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M4 6h16" />
              <path d="M4 12h16" />
              <path d="M4 18h16" />
            </svg>
          </button>
          <div class="menu-dropdown" id="navMenuDropdown" role="menu" aria-label="Menu principal">
            {{if eq .UserRole "admin"}}<a href="/dashboard/users" role="menuitem" class="{{if eq .Path "/dashboard/users"}}active{{end}}">Usuários</a>{{end}}
            <a href="/dashboard/settings" role="menuitem" class="{{if eq .Path "/dashboard/settings"}}active{{end}}">Configurações</a>
            <a href="/dashboard/docs" role="menuitem" class="{{if eq .Path "/dashboard/docs"}}active{{end}}">Docs</a>
            <div class="menu-divider" role="separator"></div>
            <a href="/dashboard/logout" role="menuitem">Sair</a>
          </div>
        </div>
      </div>
    </nav>
  </header>
  {{end}}
  <div class="toast-container" id="toastContainer" aria-live="polite" aria-relevant="additions"></div>
  <main>
    {{if eq .ContentTemplate "login_content"}}{{template "login_content" .}}{{end}}
    {{if eq .ContentTemplate "overview_content"}}{{template "overview_content" .}}{{end}}
    {{if eq .ContentTemplate "instances_content"}}{{template "instances_content" .}}{{end}}
    {{if eq .ContentTemplate "instance_qr_content"}}{{template "instance_qr_content" .}}{{end}}
    {{if eq .ContentTemplate "users_content"}}{{template "users_content" .}}{{end}}
    {{if eq .ContentTemplate "settings_content"}}{{template "settings_content" .}}{{end}}
    {{if eq .ContentTemplate "instance_diagnostics_content"}}{{template "instance_diagnostics_content" .}}{{end}}
    {{if eq .ContentTemplate "docs_content"}}{{template "docs_content" .}}{{end}}
    {{if eq .ContentTemplate "error_content"}}{{template "error_content" .}}{{end}}
  </main>

  <!-- Modal de Confirmação Global -->
  <style>
    .confirm-overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.6);
      z-index: 9999;
      padding: 1rem;
    }

    .confirm-overlay.active {
      display: flex;
    }

    .confirm-content {
      border: 1px solid var(--border);
      border-radius: 16px;
      width: min(450px, 100%);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      animation: confirmSlideIn 0.2s ease-out;
    }

    [data-theme="dark"] .confirm-content {
      background: #1e293b;
    }

    [data-theme="light"] .confirm-content {
      background: #ffffff;
    }

    @keyframes confirmSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .confirm-header {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem 1.5rem 1rem;
    }

    .confirm-header svg {
      width: 48px;
      height: 48px;
      stroke-width: 1.5;
      color: #f59e0b;
    }

    .confirm-body {
      padding: 0 1.5rem 1.5rem;
      text-align: center;
    }

    .confirm-body h3 {
      margin: 0 0 0.75rem;
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--text);
    }

    .confirm-body p {
      margin: 0;
      font-size: 0.95rem;
      line-height: 1.5;
      color: var(--muted);
    }

    .confirm-footer {
      display: flex;
      gap: 0.75rem;
      padding: 1.25rem 1.5rem;
      border-top: 1px solid var(--border);
    }

    .confirm-footer button {
      flex: 1;
      padding: 0.75rem 1.25rem;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      border: none;
    }

    .confirm-cancel {
      background: rgba(148, 163, 184, 0.12);
      border: 1px solid var(--border);
      color: var(--text);
    }

    .confirm-cancel:hover {
      background: rgba(148, 163, 184, 0.2);
    }

    .confirm-ok {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%);
      color: white;
    }

    .confirm-ok:hover {
      opacity: 0.9;
    }

    .confirm-ok.danger {
      background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
    }
  </style>

  <div class="confirm-overlay" id="customConfirmModal">
    <div class="confirm-content">
      <div class="confirm-header">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 9v4" />
          <path d="M12 17h.01" />
          <path d="M5 19h14a2 2 0 0 0 1.84 -2.75l-7.1 -12.25a2 2 0 0 0 -3.5 0l-7.1 12.25a2 2 0 0 0 1.75 2.75" />
        </svg>
      </div>
      <div class="confirm-body">
        <h3 id="customConfirmTitle">Confirmar ação</h3>
        <p id="customConfirmMessage"></p>
      </div>
      <div class="confirm-footer">
        <button type="button" class="confirm-cancel" id="customConfirmCancel">Cancelar</button>
        <button type="button" class="confirm-ok" id="customConfirmOk">Confirmar</button>
      </div>
    </div>
  </div>

  <script>
    (function () {
      function getTheme() {
        try {
          var saved = localStorage.getItem('apime_theme');
          if (saved === 'light' || saved === 'dark') return saved;
        } catch (_) {}
        return (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) ? 'light' : 'dark';
      }

      function applyTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        var btn = document.getElementById('themeToggle');
        if (btn) btn.setAttribute('aria-label', theme === 'dark' ? 'Alternar para tema claro' : 'Alternar para tema escuro');
        try { localStorage.setItem('apime_theme', theme); } catch (_) {}
        syncThemeIcon();
      }

      function syncThemeIcon() {
        var cur = document.documentElement.getAttribute('data-theme') || 'dark';
        var sun = document.getElementById('themeIconSun');
        var moon = document.getElementById('themeIconMoon');
        var sunmoon = document.getElementById('themeIconSunMoon');
        
        if (sun && moon && sunmoon) {
          sun.style.display = cur === 'dark' ? 'block' : 'none';
          moon.style.display = cur === 'light' ? 'block' : 'none';
          sunmoon.style.display = 'none';
        }
      }

      function createToast(kind, message, timeoutMs) {
        var container = document.getElementById('toastContainer');
        if (!container || !message) return;

        var toast = document.createElement('div');
        toast.className = 'toast toast-' + (kind || 'success');

        var icon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        icon.setAttribute('class', 'toast-icon');
        icon.setAttribute('viewBox', '0 0 24 24');
        icon.setAttribute('fill', 'none');
        icon.setAttribute('aria-hidden', 'true');
        var path1 = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        var path2 = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        if ((kind || 'success') === 'error') {
          path1.setAttribute('d', 'M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Z');
          path2.setAttribute('d', 'M12 8v5m0 3h.01');
        } else {
          path1.setAttribute('d', 'M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Z');
          path2.setAttribute('d', 'm8.5 12.5 2.2 2.2 4.8-5.2');
        }
        path1.setAttribute('stroke', 'currentColor');
        path1.setAttribute('stroke-width', '1.6');
        path2.setAttribute('stroke', 'currentColor');
        path2.setAttribute('stroke-width', '1.8');
        path2.setAttribute('stroke-linecap', 'round');
        path2.setAttribute('stroke-linejoin', 'round');
        icon.appendChild(path1);
        icon.appendChild(path2);

        var body = document.createElement('div');
        body.className = 'toast-body';
        body.textContent = message;

        var close = document.createElement('button');
        close.className = 'toast-close';
        close.setAttribute('type', 'button');
        close.setAttribute('aria-label', 'Fechar');
        close.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M18 6 6 18" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/><path d="M6 6l12 12" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>';
        function dismiss() {
          if (!toast || !toast.parentNode) return;
          toast.classList.add('hiding');
          window.setTimeout(function () {
            if (toast && toast.parentNode) toast.remove();
          }, 150);
        }
        close.addEventListener('click', dismiss);

        toast.appendChild(icon);
        toast.appendChild(body);
        toast.appendChild(close);
        container.appendChild(toast);

        var ms = typeof timeoutMs === 'number' ? timeoutMs : 3500;
        window.setTimeout(function () {
          dismiss();
        }, ms);
      }

      // Expor createToast globalmente para outros templates
      window.createToast = createToast;

      var theme = getTheme();
      applyTheme(theme);
      var toggle = document.getElementById('themeToggle');
      if (toggle) {
        toggle.addEventListener('click', function () {
          var cur = document.documentElement.getAttribute('data-theme') || 'dark';
          applyTheme(cur === 'dark' ? 'light' : 'dark');
        });
      }

      var navMenuToggle = document.getElementById('navMenuToggle');
      var navMenuDropdown = document.getElementById('navMenuDropdown');
      if (navMenuToggle && navMenuDropdown) {
        function setMenuOpen(open) {
          navMenuDropdown.style.display = open ? 'block' : 'none';
          navMenuToggle.setAttribute('aria-expanded', open ? 'true' : 'false');
        }

        setMenuOpen(false);
        navMenuToggle.addEventListener('click', function (e) {
          e.preventDefault();
          e.stopPropagation();
          var isOpen = navMenuDropdown.style.display === 'block';
          setMenuOpen(!isOpen);
        });

        document.addEventListener('click', function (e) {
          if (navMenuDropdown.style.display !== 'block') return;
          if (navMenuDropdown.contains(e.target) || navMenuToggle.contains(e.target)) return;
          setMenuOpen(false);
        });

        document.addEventListener('keydown', function (e) {
          if (e.key === 'Escape') setMenuOpen(false);
        });

        navMenuDropdown.addEventListener('click', function (e) {
          var el = e.target;
          if (!el) return;
          if (el.tagName && el.tagName.toLowerCase() === 'a') setMenuOpen(false);
        });
      }

      var params = new URLSearchParams(window.location.search);
      if (params.has('success')) createToast('success', params.get('success'));
      if (params.has('error')) createToast('error', params.get('error'));

      // Modal de Confirmação Global
      window.customConfirm = function(message, title = 'Confirmar ação', options = {}) {
        return new Promise(function(resolve) {
          var modal = document.getElementById('customConfirmModal');
          var titleEl = document.getElementById('customConfirmTitle');
          var messageEl = document.getElementById('customConfirmMessage');
          var cancelBtn = document.getElementById('customConfirmCancel');
          var okBtn = document.getElementById('customConfirmOk');
          
          titleEl.textContent = title;
          messageEl.textContent = message;
          
          // Aplicar classe danger se for ação destrutiva
          if (options.danger) {
            okBtn.classList.add('danger');
          } else {
            okBtn.classList.remove('danger');
          }
          
          // Atualizar texto do botão OK se fornecido
          okBtn.textContent = options.confirmText || 'Confirmar';
          cancelBtn.textContent = options.cancelText || 'Cancelar';
          
          modal.classList.add('active');
          
          function handleResponse(result) {
            modal.classList.remove('active');
            cancelBtn.removeEventListener('click', handleCancel);
            okBtn.removeEventListener('click', handleOk);
            modal.removeEventListener('click', handleOverlay);
            document.removeEventListener('keydown', handleEscape);
            resolve(result);
          }
          
          function handleCancel() { handleResponse(false); }
          function handleOk() { handleResponse(true); }
          function handleOverlay(e) { if (e.target === modal) handleResponse(false); }
          function handleEscape(e) { if (e.key === 'Escape') handleResponse(false); }
          
          cancelBtn.addEventListener('click', handleCancel);
          okBtn.addEventListener('click', handleOk);
          modal.addEventListener('click', handleOverlay);
          document.addEventListener('keydown', handleEscape);
        });
      };

      window.customAlert = function(message, title = 'Aviso', options = {}) {
        return new Promise(function(resolve) {
          var modal = document.getElementById('customConfirmModal');
          var titleEl = document.getElementById('customConfirmTitle');
          var messageEl = document.getElementById('customConfirmMessage');
          var cancelBtn = document.getElementById('customConfirmCancel');
          var okBtn = document.getElementById('customConfirmOk');
          
          titleEl.textContent = title;
          messageEl.textContent = message;
          
          // Esconder botão cancelar para alert
          cancelBtn.style.display = 'none';
          okBtn.textContent = options.okText || 'OK';
          okBtn.classList.remove('danger');
          
          modal.classList.add('active');
          
          function handleResponse() {
            modal.classList.remove('active');
            cancelBtn.style.display = '';
            okBtn.removeEventListener('click', handleResponse);
            modal.removeEventListener('click', handleOverlay);
            document.removeEventListener('keydown', handleEscape);
            resolve();
          }
          
          function handleOverlay(e) { if (e.target === modal) handleResponse(); }
          function handleEscape(e) { if (e.key === 'Escape') handleResponse(); }
          
          okBtn.addEventListener('click', handleResponse);
          modal.addEventListener('click', handleOverlay);
          document.addEventListener('keydown', handleEscape);
        });
      };
    })();
  </script>
</body>
</html>
{{end}}

